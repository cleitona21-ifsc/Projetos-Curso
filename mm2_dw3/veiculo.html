<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Veículo - React</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>

<body class="bg-gray-900 text-gray-100 min-h-screen py-12">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const CadastroVeiculo = () => {
            const [formData, setFormData] = useState({
                marca: '',
                modelo: '',
                placa: ''
            });

            const [errors, setErrors] = useState({});
            const [isFormValid, setIsFormValid] = useState(false);
            const [status, setStatus] = useState({ type: '', message: '' });

            const placaRegex = /^[A-Z]{3}[0-9][0-9A-Z][0-9]{2}$/;

            const handleChange = (e) => {
                const { name, value } = e.target;
                const newValue = name === 'placa' ? value.toUpperCase() : value;

                setFormData({ ...formData, [name]: newValue });
                validateField(name, newValue);
            };

            const validateField = (name, value) => {
                let newErrors = { ...errors };

                switch (name) {
                    case 'marca':
                        newErrors.marca = value.length < 2 ? 'A marca deve ter pelo menos 2 caracteres.' : '';
                        break;
                    case 'modelo':
                        newErrors.modelo = value.length < 2 ? 'O modelo deve ter pelo menos 2 caracteres.' : '';
                        break;
                    case 'placa':
                        const cleanPlaca = value.replace('-', '');
                        newErrors.placa = !placaRegex.test(cleanPlaca) 
                            ? 'Formato inválido (Ex: ABC1234 ou ABC1C34)' 
                            : '';
                        break;
                }
                setErrors(newErrors);
            };

            useEffect(() => {
                const hasValues = formData.marca && formData.modelo && formData.placa;
                const noErrors = Object.values(errors).every((msg) => msg === '');
                setIsFormValid(hasValues && noErrors);
            }, [formData, errors]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!isFormValid) return;

                setStatus({ type: 'loading', message: 'Salvando...' });

                try {
                    
                    const response = await fetch('cadastrar_veiculo.php', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(formData),
                    });

                    const result = await response.json();

                    if (response.ok) {
                        setStatus({ type: 'success', message: result.mensagem });
                        setFormData({ marca: '', modelo: '', placa: '' });
                    } else {
                        throw new Error(result.mensagem || 'Erro desconhecido');
                    }
                } catch (error) {
                    console.error(error);
                    setStatus({ 
                        type: 'error', 
                        message: 'Erro: ' + error.message 
                    });
                }
            };

            return (
                <div className="flex items-center justify-center">
                    <div className="bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-md">
                        <h2 className="text-2xl font-bold mb-6 text-center text-white">Cadastro de Veículo (React)</h2>

                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-300 mb-1">Marca</label>
                                <input
                                    type="text"
                                    name="marca"
                                    value={formData.marca}
                                    onChange={handleChange}
                                    className={`w-full px-3 py-2 bg-gray-700 border rounded-lg text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors.marca ? 'border-red-500' : 'border-gray-600'}`}
                                    placeholder="Ex: Toyota"
                                />
                                {errors.marca && <p className="text-red-400 text-xs mt-1">{errors.marca}</p>}
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-300 mb-1">Modelo</label>
                                <input
                                    type="text"
                                    name="modelo"
                                    value={formData.modelo}
                                    onChange={handleChange}
                                    className={`w-full px-3 py-2 bg-gray-700 border rounded-lg text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors.modelo ? 'border-red-500' : 'border-gray-600'}`}
                                    placeholder="Ex: Corolla"
                                />
                                {errors.modelo && <p className="text-red-400 text-xs mt-1">{errors.modelo}</p>}
                            </div>

                            <div>
                                <label className="block text-sm font-medium text-gray-300 mb-1">Placa</label>
                                <input
                                    type="text"
                                    name="placa"
                                    value={formData.placa}
                                    onChange={handleChange}
                                    maxLength={7}
                                    className={`w-full px-3 py-2 bg-gray-700 border rounded-lg text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 ${errors.placa ? 'border-red-500' : 'border-gray-600'}`}
                                    placeholder="ABC1234"
                                />
                                {errors.placa && <p className="text-red-400 text-xs mt-1">{errors.placa}</p>}
                            </div>

                            <div>
                                <button
                                    type="submit"
                                    disabled={!isFormValid || status.type === 'loading'}
                                    className={`w-full font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out transform mt-4 
                                        ${isFormValid 
                                        ? 'bg-green-600 hover:bg-green-700 text-white hover:scale-105' 
                                        : 'bg-gray-600 text-gray-400 cursor-not-allowed opacity-50'}`}
                                >
                                    {status.type === 'loading' ? 'Enviando...' : 'Salvar Veículo'}
                                </button>
                            </div>
                        </form>

                        {status.message && (
                            <div className={`mt-4 text-center p-3 rounded ${status.type === 'error' ? 'bg-red-900/50 text-red-200' : 'bg-green-900/50 text-green-200'}`}>
                                {status.message}
                            </div>
                        )}

                        <div className="mt-6 text-center">
                            <a href="index.html" className="text-blue-400 hover:text-blue-300 transition duration-300">
                                &larr; Voltar à página inicial
                            </a>
                        </div>
                    </div>
                </div>
            );
        };

        
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CadastroVeiculo />);
    </script>
</body>
</html>